<!DOCTYPE html>
<html>
<head>
    <title>GAé›†æˆæµ‹è¯•</title>
</head>
<body>
    <h1>ğŸ§ª GAé›†æˆæµ‹è¯•é¡µé¢</h1>
    
    <div style="margin: 20px; padding: 20px; border: 1px solid #ccc;">
        <h2>æµ‹è¯•æ­¥éª¤ï¼š</h2>
        <button onclick="testConsentFlow()">1. æµ‹è¯•Consentæµç¨‹</button><br><br>
        <button onclick="testGA()">2. æµ‹è¯•GAå‡½æ•°</button><br><br>
        <button onclick="testEvents()">3. æµ‹è¯•è‡ªå®šä¹‰äº‹ä»¶</button><br><br>
        <button onclick="clearConsent()">4. æ¸…é™¤Consent</button>
    </div>
    
    <div id="results" style="margin: 20px; padding: 20px; background: #f5f5f5;">
        <h3>æµ‹è¯•ç»“æœï¼š</h3>
        <pre id="output"></pre>
    </div>

    <script>
        function log(message) {
            const output = document.getElementById('output');
            output.textContent += new Date().toISOString() + ': ' + message + '\n';
        }
        
        function testConsentFlow() {
            log('=== æµ‹è¯•Consentæµç¨‹ ===');
            
            // æ£€æŸ¥localStorage
            const stored = localStorage.getItem('geppetto_cookie_consent');
            log('LocalStorage consent: ' + (stored || 'null'));
            
            // æ¨¡æ‹Ÿæ¥å—æ‰€æœ‰Cookie
            const consent = {
                essential: true,
                analytics: true,
                marketing: true,
                timestamp: Date.now()
            };
            
            localStorage.setItem('geppetto_cookie_consent', JSON.stringify(consent));
            log('è®¾ç½®consentä¸º: ' + JSON.stringify(consent));
            
            // è§¦å‘äº‹ä»¶
            window.dispatchEvent(new CustomEvent('cookieConsentChanged', {
                detail: consent
            }));
            log('è§¦å‘äº†cookieConsentChangedäº‹ä»¶');
        }
        
        function testGA() {
            log('=== æµ‹è¯•GAå‡½æ•° ===');
            log('gtagç±»å‹: ' + typeof window.gtag);
            log('gaInitialized: ' + window.gaInitialized);
            log('checkConsentAndInitialize: ' + typeof window.checkConsentAndInitialize);
            
            if (window.checkConsentAndInitialize) {
                window.checkConsentAndInitialize();
                log('æ‰§è¡Œäº†checkConsentAndInitialize()');
            }
        }
        
        function testEvents() {
            log('=== æµ‹è¯•è‡ªå®šä¹‰äº‹ä»¶ ===');
            
            if (window.trackQuoteRequest) {
                window.trackQuoteRequest({ estimatedValue: 299 });
                log('å‘é€äº†trackQuoteRequestäº‹ä»¶');
            } else {
                log('trackQuoteRequestå‡½æ•°ä¸å­˜åœ¨');
            }
            
            if (window.trackFileUpload) {
                window.trackFileUpload({ fileType: 'pdf', fileName: 'test.pdf' });
                log('å‘é€äº†trackFileUploadäº‹ä»¶');
            } else {
                log('trackFileUploadå‡½æ•°ä¸å­˜åœ¨');
            }
        }
        
        function clearConsent() {
            localStorage.removeItem('geppetto_cookie_consent');
            log('å·²æ¸…é™¤consent');
            location.reload();
        }
        
        // é¡µé¢åŠ è½½æ—¶çš„åˆå§‹æ£€æŸ¥
        window.addEventListener('load', () => {
            log('é¡µé¢åŠ è½½å®Œæˆ');
            setTimeout(() => {
                log('=== åˆå§‹çŠ¶æ€æ£€æŸ¥ ===');
                log('gtag: ' + typeof window.gtag);
                log('gaInitialized: ' + window.gaInitialized);
                log('localStorage consent: ' + localStorage.getItem('geppetto_cookie_consent'));
            }, 1000);
        });
    </script>
</body>
</html>