---
import BaseLayout from '../layouts/BaseLayout.astro';
import { getCollection } from 'astro:content';

// è·å–æ‰€æœ‰FAQ
const allFAQs = await getCollection('faqs');
// æŒ‰orderæ’åº
const faqs = allFAQs.sort((a, b) => a.data.order - b.data.order);
// è·å–ç‰¹è‰²FAQ
const featuredFAQs = faqs.filter(faq => faq.data.featured);
// æŒ‰åˆ†ç±»åˆ†ç»„
const faqsByCategory = faqs.reduce((acc, faq) => {
  const category = faq.data.category;
  if (!acc[category]) {
    acc[category] = [];
  }
  acc[category].push(faq);
  return acc;
}, {});
---

<BaseLayout title="å¸¸è§é—®é¢˜ | Geppetto - AIé©±åŠ¨ç²¾å¯†åˆ¶é€ FAQ" description="Geppetto AI+å­¦å¾’åˆ¶é€ å¸¸è§é—®é¢˜è§£ç­”ï¼Œæ¶µç›–å®šä»·æˆæœ¬ã€AIæŠ€æœ¯ã€è´¨é‡ç²¾åº¦ã€äº¤ä»˜æ—¶é—´ã€èµ·è®¢é‡ç­‰æ ¸å¿ƒé—®é¢˜ï¼Œå¸®æ‚¨å¿«é€Ÿäº†è§£æˆ‘ä»¬çš„æœåŠ¡ä¼˜åŠ¿ã€‚">
  <main class="min-h-screen">
    <!-- Hero Section -->
    <section class="bg-gradient-to-br from-purple-600 via-blue-600 to-purple-800 text-white py-20">
      <div class="container mx-auto px-6">
        <div class="max-w-4xl mx-auto text-center">
          <h1 class="text-5xl font-bold mb-6">
            ğŸ’¡ å¸¸è§é—®é¢˜è§£ç­”
          </h1>
          <p class="text-2xl text-blue-100 mb-8">
            å…³äºGeppetto AI+å­¦å¾’åˆ¶é€ çš„ä¸€åˆ‡ç–‘é—®ï¼Œè¿™é‡Œéƒ½æœ‰ç­”æ¡ˆ
          </p>
          
          <!-- å¿«é€Ÿå¯¼èˆª -->
          <div class="bg-white/10 backdrop-blur-sm rounded-2xl p-6 mb-8">
            <h3 class="text-xl font-semibold mb-4">ğŸš€ çƒ­é—¨é—®é¢˜å¿«é€Ÿå¯¼èˆª</h3>
            <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4">
              {featuredFAQs.map((faq) => (
                <a 
                  href={`#faq-${faq.slug}`}
                  class="bg-white/10 rounded-xl p-3 hover:bg-white/20 transition-colors duration-300 text-left"
                >
                  <div class="text-sm font-medium line-clamp-2">{faq.data.question}</div>
                </a>
              ))}
            </div>
          </div>

          <!-- æœç´¢æ¡† -->
          <div class="max-w-2xl mx-auto">
            <div class="relative">
              <input 
                type="text" 
                id="faq-search"
                placeholder="ğŸ” æœç´¢ä½ å…³å¿ƒçš„é—®é¢˜..." 
                class="w-full px-6 py-4 pr-12 rounded-2xl text-gray-800 text-lg focus:outline-none focus:ring-4 focus:ring-yellow-300"
              />
              <svg class="w-6 h-6 absolute right-4 top-1/2 transform -translate-y-1/2 text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"></path>
              </svg>
            </div>
          </div>
        </div>
      </div>
    </section>

    <!-- ç‰¹è‰²FAQå±•ç¤º -->
    <section class="py-20 bg-gray-50">
      <div class="container mx-auto px-6">
        <div class="max-w-6xl mx-auto">
          <div class="text-center mb-16">
            <h2 class="text-4xl font-bold text-gray-800 mb-6">
              â­ æœ€å—å…³æ³¨çš„é—®é¢˜
            </h2>
            <p class="text-xl text-gray-600">
              90%çš„å®¢æˆ·éƒ½åœ¨å…³å¿ƒè¿™äº›æ ¸å¿ƒé—®é¢˜
            </p>
          </div>

          <div class="grid grid-cols-1 lg:grid-cols-2 gap-8">
            {await Promise.all(featuredFAQs.map(async (faq) => {
              const { Content } = await faq.render();
              return (
                <div id={`faq-${faq.slug}`} class="bg-white rounded-2xl shadow-lg p-8 hover:shadow-xl transition-all duration-300">
                  <div class="flex items-start space-x-4 mb-6">
                    <div class="w-12 h-12 bg-gradient-to-r from-purple-500 to-blue-500 rounded-xl flex items-center justify-center flex-shrink-0">
                      <span class="text-white font-bold">Q</span>
                    </div>
                    <div class="flex-1">
                      <span class="bg-purple-100 text-purple-700 text-xs font-medium px-3 py-1 rounded-full mb-3 inline-block">
                        {faq.data.category}
                      </span>
                      <h3 class="text-xl font-bold text-gray-800 mb-4">{faq.data.question}</h3>
                    </div>
                  </div>
                  
                  <div class="prose prose-gray max-w-none ml-16">
                    <Content />
                  </div>
                </div>
              );
            }))}
          </div>
        </div>
      </div>
    </section>

    <!-- åˆ†ç±»FAQåˆ—è¡¨ -->
    <section class="py-20 bg-white">
      <div class="container mx-auto px-6">
        <div class="max-w-6xl mx-auto">
          <div class="text-center mb-16">
            <h2 class="text-4xl font-bold text-gray-800 mb-6">
              ğŸ“š å…¨éƒ¨é—®é¢˜åˆ†ç±»
            </h2>
            <p class="text-xl text-gray-600">
              æŒ‰ä¸»é¢˜åˆ†ç±»çš„è¯¦ç»†é—®é¢˜è§£ç­”
            </p>
          </div>

          <!-- åˆ†ç±»æ ‡ç­¾ -->
          <div class="flex flex-wrap justify-center gap-4 mb-12">
            <button class="category-filter bg-purple-100 text-purple-700 px-6 py-3 rounded-full font-semibold hover:bg-purple-200 transition-colors duration-300 active" data-category="all">
              ğŸ” å…¨éƒ¨åˆ†ç±»
            </button>
            {Object.keys(faqsByCategory).map((category) => (
              <button class={`category-filter px-6 py-3 rounded-full font-semibold transition-colors duration-300 ${
                category === 'å®šä»·æˆæœ¬' ? 'bg-blue-100 text-blue-700 hover:bg-blue-200' :
                category === 'AIæŠ€æœ¯' ? 'bg-green-100 text-green-700 hover:bg-green-200' :
                category === 'è´¨é‡ç²¾åº¦' ? 'bg-red-100 text-red-700 hover:bg-red-200' :
                category === 'äº¤ä»˜æ—¶é—´' ? 'bg-yellow-100 text-yellow-700 hover:bg-yellow-200' :
                category === 'èµ·è®¢é‡' ? 'bg-indigo-100 text-indigo-700 hover:bg-indigo-200' :
                category === 'ææ–™èƒ½åŠ›' ? 'bg-pink-100 text-pink-700 hover:bg-pink-200' :
                'bg-gray-100 text-gray-700 hover:bg-gray-200'
              }`} data-category={category}>
                {category === 'å®šä»·æˆæœ¬' ? 'ğŸ’°' : 
                 category === 'AIæŠ€æœ¯' ? 'ğŸ¤–' :
                 category === 'è´¨é‡ç²¾åº¦' ? 'ğŸ¯' :
                 category === 'äº¤ä»˜æ—¶é—´' ? 'âš¡' :
                 category === 'èµ·è®¢é‡' ? 'ğŸ“¦' :
                 category === 'ææ–™èƒ½åŠ›' ? 'ğŸ”§' :
                 category === 'ä»˜æ¬¾è´¦æœŸ' ? 'ğŸ’³' :
                 category === 'å”®åæœåŠ¡' ? 'ğŸ›¡ï¸' :
                 category === 'ç«äº‰ä¼˜åŠ¿' ? 'ğŸ†' :
                 category === 'å®‰å…¨éšç§' ? 'ğŸ”’' : 'â“'} {category}
              </button>
            ))}
          </div>

          <!-- FAQåˆ—è¡¨ -->
          <div class="space-y-4" id="faq-list">
            {await Promise.all(faqs.map(async (faq, index) => {
              const { Content } = await faq.render();
              return (
                <div class="faq-item bg-white border border-gray-200 rounded-xl hover:shadow-lg transition-all duration-300" data-category={faq.data.category}>
                  <button 
                    class="faq-toggle w-full px-8 py-6 text-left flex items-center justify-between hover:bg-gray-50 rounded-xl transition-colors duration-300"
                    onclick={`toggleFaq(${index})`}
                  >
                    <div class="flex items-center space-x-4 flex-1">
                      <div class="w-8 h-8 bg-gradient-to-r from-purple-100 to-blue-100 rounded-lg flex items-center justify-center flex-shrink-0">
                        <span class="text-purple-600 font-bold text-sm">Q</span>
                      </div>
                      <div class="flex-1">
                        <span class={`text-xs font-medium px-2 py-1 rounded-full mr-3 ${
                          faq.data.category === 'å®šä»·æˆæœ¬' ? 'bg-blue-100 text-blue-700' :
                          faq.data.category === 'AIæŠ€æœ¯' ? 'bg-green-100 text-green-700' :
                          faq.data.category === 'è´¨é‡ç²¾åº¦' ? 'bg-red-100 text-red-700' :
                          faq.data.category === 'äº¤ä»˜æ—¶é—´' ? 'bg-yellow-100 text-yellow-700' :
                          faq.data.category === 'èµ·è®¢é‡' ? 'bg-indigo-100 text-indigo-700' :
                          faq.data.category === 'ææ–™èƒ½åŠ›' ? 'bg-pink-100 text-pink-700' :
                          'bg-gray-100 text-gray-700'
                        }`}>
                          {faq.data.category}
                        </span>
                        <h3 class="text-lg font-semibold text-gray-800">{faq.data.question}</h3>
                        {faq.data.featured && (
                          <span class="bg-yellow-100 text-yellow-800 text-xs font-medium px-2 py-1 rounded-full ml-2">â­ çƒ­é—¨</span>
                        )}
                      </div>
                    </div>
                    <svg class={`w-5 h-5 text-gray-400 transform transition-transform duration-300 faq-icon-${index}`} fill="none" stroke="currentColor" viewBox="0 0 24 24">
                      <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"></path>
                    </svg>
                  </button>
                  
                  <div id={`faq-content-${index}`} class="faq-content hidden px-8 pb-6">
                    <div class="ml-12 prose prose-gray max-w-none">
                      <Content />
                    </div>
                  </div>
                </div>
              );
            }))}
          </div>
        </div>
      </div>
    </section>

    <!-- æ²¡æ‰¾åˆ°ç­”æ¡ˆï¼Ÿè”ç³»æˆ‘ä»¬ -->
    <section class="py-20 bg-gradient-to-r from-purple-900 to-blue-900 text-white">
      <div class="container mx-auto px-6 text-center">
        <h2 class="text-4xl font-bold mb-6">
          ğŸ¤” æ²¡æ‰¾åˆ°ä½ æƒ³è¦çš„ç­”æ¡ˆï¼Ÿ
        </h2>
        <p class="text-2xl text-blue-100 mb-12">
          æˆ‘ä»¬çš„ä¸“å®¶å›¢é˜Ÿéšæ—¶ä¸ºæ‚¨è§£ç­”ä»»ä½•ç–‘é—®
        </p>

        <div class="grid grid-cols-1 md:grid-cols-3 gap-8 mb-12">
          <div class="bg-white/10 backdrop-blur-sm rounded-xl p-6">
            <div class="text-4xl mb-4">ğŸ“</div>
            <h3 class="text-xl font-semibold mb-2">ç”µè¯å’¨è¯¢</h3>
            <p class="text-blue-100">400-XXX-XXXX</p>
            <p class="text-sm text-blue-200">7x24å°æ—¶ä¸“å®¶åœ¨çº¿</p>
          </div>
          
          <div class="bg-white/10 backdrop-blur-sm rounded-xl p-6">
            <div class="text-4xl mb-4">ğŸ’¬</div>
            <h3 class="text-xl font-semibold mb-2">åœ¨çº¿å®¢æœ</h3>
            <p class="text-blue-100">å®æ—¶é—®ç­”</p>
            <p class="text-sm text-blue-200">å·¥ä½œæ—¥9:00-18:00</p>
          </div>
          
          <div class="bg-white/10 backdrop-blur-sm rounded-xl p-6">
            <div class="text-4xl mb-4">ğŸ“§</div>
            <h3 class="text-xl font-semibold mb-2">é‚®ä»¶æ”¯æŒ</h3>
            <p class="text-blue-100">support@geppetto.ai</p>
            <p class="text-sm text-blue-200">24å°æ—¶å†…å›å¤</p>
          </div>
        </div>

        <div class="flex flex-col sm:flex-row gap-6 justify-center items-center">
          <a href="/contact" class="bg-gradient-to-r from-yellow-400 to-orange-500 text-purple-900 px-12 py-4 rounded-full text-xl font-bold hover:from-yellow-300 hover:to-orange-400 transform hover:scale-105 transition-all duration-300 shadow-2xl">
            ğŸ’¬ ç«‹å³å’¨è¯¢ä¸“å®¶
          </a>
          
          <a href="/ai-quote" class="border-2 border-white text-white px-8 py-4 rounded-full text-lg font-semibold hover:bg-white hover:text-purple-900 transition-all duration-300">
            ğŸ¤– AIæ™ºèƒ½æŠ¥ä»·
          </a>
        </div>

        <div class="mt-8 text-blue-100">
          <p class="text-lg">
            ğŸ’¡ æ¯ä¸ªé—®é¢˜éƒ½æ˜¯æ”¹è¿›æˆ‘ä»¬æœåŠ¡çš„æœºä¼šï¼Œè¯·ä¸è¦çŠ¹è±«è”ç³»æˆ‘ä»¬
          </p>
        </div>
      </div>
    </section>
  </main>
</BaseLayout>

<script>
  // FAQæœç´¢åŠŸèƒ½
  document.addEventListener('DOMContentLoaded', () => {
    const searchInput = document.getElementById('faq-search');
    const faqItems = document.querySelectorAll('.faq-item');
    const categoryFilters = document.querySelectorAll('.category-filter');

    // æœç´¢åŠŸèƒ½
    searchInput.addEventListener('input', (e) => {
      const searchTerm = e.target.value.toLowerCase();
      
      faqItems.forEach(item => {
        const question = item.querySelector('h3').textContent.toLowerCase();
        const content = item.querySelector('.faq-content').textContent.toLowerCase();
        
        if (question.includes(searchTerm) || content.includes(searchTerm)) {
          item.style.display = 'block';
          item.classList.add('search-highlight');
        } else {
          item.style.display = 'none';
          item.classList.remove('search-highlight');
        }
      });
    });

    // åˆ†ç±»ç­›é€‰åŠŸèƒ½
    categoryFilters.forEach(filter => {
      filter.addEventListener('click', () => {
        const category = filter.getAttribute('data-category');
        
        // æ›´æ–°æŒ‰é’®çŠ¶æ€
        categoryFilters.forEach(btn => btn.classList.remove('active'));
        filter.classList.add('active');

        // è¿‡æ»¤FAQ
        faqItems.forEach(item => {
          const itemCategory = item.getAttribute('data-category');
          if (category === 'all' || itemCategory === category) {
            item.style.display = 'block';
          } else {
            item.style.display = 'none';
          }
        });

        // æ¸…ç©ºæœç´¢
        searchInput.value = '';
      });
    });
  });

  // FAQæŠ˜å å±•å¼€åŠŸèƒ½
  function toggleFaq(index) {
    const content = document.getElementById(`faq-content-${index}`);
    const icon = document.querySelector(`.faq-icon-${index}`);
    
    if (content.classList.contains('hidden')) {
      content.classList.remove('hidden');
      content.classList.add('animate-fade-in');
      icon.style.transform = 'rotate(180deg)';
    } else {
      content.classList.add('hidden');
      content.classList.remove('animate-fade-in');
      icon.style.transform = 'rotate(0deg)';
    }
  }

  // æ·»åŠ CSSåŠ¨ç”»
  const style = document.createElement('style');
  style.textContent = `
    .animate-fade-in {
      animation: fadeIn 0.3s ease-in-out;
    }
    @keyframes fadeIn {
      from { opacity: 0; transform: translateY(-10px); }
      to { opacity: 1; transform: translateY(0); }
    }
    .search-highlight {
      background: linear-gradient(90deg, #fef3c7, #ffffff);
    }
    .category-filter.active {
      background: linear-gradient(90deg, #7c3aed, #3b82f6) !important;
      color: white !important;
    }
    .line-clamp-2 {
      display: -webkit-box;
      -webkit-line-clamp: 2;
      -webkit-box-orient: vertical;
      overflow: hidden;
    }
  `;
  document.head.appendChild(style);
</script>